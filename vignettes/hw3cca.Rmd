---
title: "hw3cca"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{hw3cca}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# hw3cca

## Overview

The goal of hw3cca is to replicate some of the functionality of the existing R package. 
This is a simple method to calculate CCA. It is designed to calculate the CCA when the number of input X and Y columns is the same. The correlation generated is correct when the number of columns is different, but the number of rows or columns for the correlation coefficient will be different.

* `cca_simple()` calculate the simple Canonical Correlation.
* `cancor()` is R-build-in function to test whether the result is the same.

## Installation

You can install the development version of hw3cca from [GitHub](https://github.com/) with:

```{r}
# You can install it with vignettes
# devtools::install_github("lianchenglu/biostat625hw3")
devtools::install_github('lianchenglu/biostat625hw3',build_vignettes =T)
```

## Usage

In conclusion, there are 4 steps to perform CCA by R

1.  Load the raw data

2.  Scale original data

3.  Canonical correlation analysis `simple_cca` (or `cancor`)

4.  Correlation coefficient significance test

Here, I generate data randomly. The result of `cca_simple` and `cancor` is the same.  There are two canonical correlation coefficients. `xcoef` is coefficient for x variables so this is linear combination coefficients. `ycoef` is coefficient for y variables so this is linear combination coefficients.

```{r setup}
library(hw3cca)
## basic example code
set.seed(123)
x1 <- matrix(rnorm(20000), 10000, 2)
y1 <- matrix(rnorm(20000), 10000, 2)
cca_simple(x1, y1)
cancor(x1, y1)[1:3]
```

Similarly, you can gernerate a bigger dataset.

```{r}
x2 <- matrix(rnorm(2000000), 400000, 5)
y2 <- matrix(rnorm(2000000), 400000, 5)
cca_simple(x2, y2)[1]
cancor(x2, y2)[1]
```

## test
Comparison against the original R functions on simulated datasets to demonstrate both the correctness (e.g., via all.equal()) 

```{r echo=FALSE}
library(testthat)
test_that("cca_simple function", {
  # Using R's built-in cancor function to get the baseline results,
  # only the corrected correlations, x and y coefficients are obtained
  benchmark <- cancor(x1, y1)[1:3]
  # Get test results using the cca_simple to be tested
  result <- cca_simple(x1, y1)
  # Test to match benchmark results to test results
  expect_equal(result, benchmark, tolerance = 0.0001)
  # Time test the function using system time
  print(system.time(cca_simple(x1, y1)))
  # Time test R's built-in cancor function using system time
  print(system.time(cancor(x1, y1)))
})
```

The efficiency of the implemented functions.

```{r}
bench::mark(
  cca_simple(x1, y1),
  cancor(x1,y1)[1:3],
  iterations = 10,
  check = TRUE
)

```

